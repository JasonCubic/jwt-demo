FROM node:14.17.0-alpine3.13

WORKDIR /usr/app

ARG NODE_ENV
ARG HTTP_PROXY
ARG HTTPS_PROXY
ARG ACCESS_TOKEN_SECRET
ARG REFRESH_TOKEN_SECRET

ENV NODE_ENV ${NODE_ENV}
ENV ACCESS_TOKEN_SECRET ${ACCESS_TOKEN_SECRET}
ENV REFRESH_TOKEN_SECRET ${REFRESH_TOKEN_SECRET}

COPY packages/jwt-demo-api packages/jwt-demo-api
COPY package.json package.json
COPY packages/jwt-demo-logs packages/jwt-demo-logs

RUN yarn install --pure-lockfile --proxy "${HTTP_PROXY}" --https-proxy "${HTTPS_PROXY}" \
&& yarn cache clean

CMD ["yarn", "workspace", "jwt-demo-api", "dev"]
